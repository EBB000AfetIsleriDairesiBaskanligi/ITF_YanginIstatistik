<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>T.C. ESKİŞEHİR BÜYÜKŞEHİR BELEDİYESİ | İtfaiye Dairesi Başkanlığı</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Leaflet -->
    <link rel="stylesheet" href="../kutuphane/leaflet/leaflet.css">
    <script src="./kutuphane/leaflet/leaflet.js"></script>
    <script src="./kutuphane/Proj4Leaflet/lib/proj4.js"></script>
    <script src="./kutuphane/Proj4Leaflet/lib/proj4-compressed.js"></script>
    <script src="./kutuphane/Proj4Leaflet/src/proj4leaflet.js"></script>
  </head>
  <body>
    <div class="container-fluid">
      <!-- BAŞLIK -->
        <div class="row">
            <div class="text-center px-3 py-3" style="height: 20vh;">
                <div class="d-flex justify-content-between">
                    <img src="./ui/img/ebb_logo.png" alt=""  width="7.5%">
                    <img src="./ui/img/itf.png" alt=""  width="7.5%">
                </div>
            </div>
        </div>

      <!-- PENCERE -->
        <div class="row">
          <!-- SOL PANEL -->
            <div class="col-3" style="height: 80vh;">
              <button class="btn btn-primary w-100" onclick="ilSiniriGoster()">İl Sınırı Göster</button>
              <!-- Olay Seçimi -->
              <select name="" id="olay" class="form-control my-2">
                <option value="bos">Olay Seçiniz</option>
                <option value="yangin">Yangın</option>
                <option value="" disabled title="Dairemizin Çalışmaları Sürmektedir.">Arama Kurtarma</option>
                <option value="" disabled title="Dairemizin Çalışmaları Sürmektedir.">Polis & Ambulans Kapı Açma</option>
                <option value="" disabled title="Dairemizin Çalışmaları Sürmektedir.">Asılsız</option>
              </select>

              <!-- Boyut Seç -->
              <select name="alan" id="seciliAlan" class="form-control my-2">
                <option value="">İncelenecek Alanı Seçiniz</option>
                <option value="ilce">İlçe</option>
                <option value="mahalle">Mahalle</option>
              </select>

              <!-- İlçe Bazında Seç -->
              <select name="ilce" id="ilceler" class="form-control my-2">
                <option value="bos">İncelenecek İlçeyi Seçiniz</option>
                <option value="ODUNPAZARI">Odunpazarı</option>
                <option value="TEPEBAŞI">Tepebaşı</option>
                <option value="ALPU">Alpu</option>
                <option value="BEYLİKOVA">Beylikova</option>
                <option value="ÇİFTELER">Çifteler</option>
                <option value="GÜNYÜZÜ">Günyüzü</option>
                <option value="HAN">Han</option>
                <option value="İNÖNÜ">İnönü</option>
                <option value="MAHMUDİYE">Mahmudiye</option>
                <option value="MİHALGAZİ">Mihalgazi</option>
                <option value="MİHALIÇÇIK">Mihalıççık</option>
                <option value="SARICAKAYA">Sarıcakaya</option>
                <option value="SEYİTGAZİ">Seyitgazi</option>
                <option value="SİVRİHİSAR">Sivrihisar</option>
              </select>

              <button class="btn btn-primary w-100" onclick="veriGoster()">Verileri Getir</button>
            </div>
          <!-- HARİTA Çalışma Alanı-->
            <div class="col-9">
              <!-- Harita Kutusu -->
              <div class="m-2" style="height: 76vh;">
                <div id="map" style="height: 76vh; width: 100%;"></div>
              </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <!-- Haritayı Ekle -->
    <script>
        var osmMap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png');
        var googleMap = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
                                                                                    subdomains:['mt0','mt1','mt2','mt3']
                                                                                  })
        var map = L.map('map', {
                                attributionControl: false,
                                layers: [googleMap, osmMap]
                            })
                            .setView([39.6950, 31.0740], 8);
        var baseMaps = {
                        "GoogleSatellite": googleMap,
                        "OpenStreetMap": osmMap
                      };
        var layerControl = L.control.layers(baseMaps).addTo(map);
      </script>

      <!-- Fonksiyonlar -->
      <script>
      // İl Sınırı Göster
      function ilSiniriGoster()
      {
        var geojsonURL = "./FakeDB/eskisehir/il.geojson";
        var xhr = new XMLHttpRequest();
        xhr.open("GET", geojsonURL, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
              var geojson = JSON.parse(xhr.responseText);
              for (var i = 0; i < geojson.features.length; i++) {
                  var feature = geojson.features[i];
                  var coordinates = feature.geometry.coordinates;
                  L.polygon(feature.geometry.coordinates[0], {
                                                    fillColor: 'transparent', // İçi doldurmayacak şekilde ayarlayın
                                                    fillOpacity: 0, // İçi doldurmayacak şekilde ayarlayın
                                                    color: 'red'
                                                  }).addTo(map);
              }
          }
        };
        xhr.send();
      }

      // ilçe ve mahalle kontrol ile gösterme
      function veriGoster() {
        var seciliOlaySec = document.getElementById("olay");
        var olay = seciliOlaySec.value;  
        if (olay == 'yangin') {
          var seciliAlanSec = document.getElementById("seciliAlan");
        var seciliAlan = seciliAlanSec.value;  
        if (seciliAlan == 'ilce'){
          ilceleriGoster()
        }    
        else if (seciliAlan == 'mahalle') {
          var ilceSec = document.getElementById("ilceler");
          var ilce = ilceSec.value;  
          if (ilce == 'bos') {
            alert('İlçe Secmediniz.')
          }
          else {
            mahalleGoster(ilce)
          }
        }
        else {
          alert('HATALI SEÇİM')
        }
        }
        else {
          alert('Bu olay türü için çalışmalarımız sürmektedir. \nLütfen olay türü olarak yangın seçiniz.')
        }
        
      }

      // ilceleri goster
      function ilceleriGoster(){
        var geojsonURL = "./FakeDB/ilceler/ilceDuzen.geojson";
        var xhr = new XMLHttpRequest();
        xhr.open("GET", geojsonURL, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
              var geojson = JSON.parse(xhr.responseText);
              // GeoJSON verilerini işleme
              for (var i = 0; i < geojson.features.length; i++) {
                  var feature = geojson.features[i];
                  var coordinates = feature.geometry.coordinates;
                  // yesil
                  if (feature.properties.TOPLAM == 0) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#007934', 
                                                color: '#007934', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Bu mahallede yangın olmadı.');
                  }
                  // lacivert
                  else if (feature.properties.TOPLAM >0 && feature.properties.TOPLAM < 30) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#12127d', 
                                                color: '#12127d', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // turuncu
                  else if (feature.properties.TOPLAM >30 && feature.properties.TOPLAM < 60) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#ff6700', 
                                                color: '#ff6700', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // sarı
                  else if (feature.properties.TOPLAM >60 && feature.properties.TOPLAM < 90) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#dcff00', 
                                                color: '#dcff00', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // kırmızı
                  else if (feature.properties.TOPLAM >90 && feature.properties.TOPLAM < 120) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#800000', 
                                                color: '#800000', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // siyah
                  else if (feature.properties.TOPLAM >120) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#011400', 
                                                color: '#011400', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
              }
          }
      };
      xhr.send();
      } 
      
      // mahalle goster
      function mahalleGoster(ilce){
        var geojsonURL = "./FakeDB/mahalle/mahalleDuzen.geojson";
        var xhr = new XMLHttpRequest();
        xhr.open("GET", geojsonURL, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
              var geojson = JSON.parse(xhr.responseText);
              for (var i = 0; i < geojson.features.length; i++) {
                  var feature = geojson.features[i];
                  if (ilce == feature.properties.ILCE) {
                    var coordinates = feature.geometry.coordinates;
                  // yesil
                  if (feature.properties.TOPLAM == 0) {
                    L.polygon(coordinates[0], {fillColor: '#007934', color: '#007934', fillOpacity: 0.5}).addTo(map).bindPopup('Bu mahallede yangın olmadı.');
                  }
                  // lacivert
                  else if (feature.properties.TOPLAM >0 && feature.properties.TOPLAM < 5) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#12127d', 
                                                color: '#12127d', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // turuncu
                  else if (feature.properties.TOPLAM >5 && feature.properties.TOPLAM < 10) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#ff6700', 
                                                color: '#ff6700', 
                                                fillOpacity: 0.5
                                              })
                                              .addTo(map)
                                              .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // sarı
                  else if (feature.properties.TOPLAM >10 && feature.properties.TOPLAM < 20) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#dcff00', 
                                                color: '#dcff00', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // kırmızı
                  else if (feature.properties.TOPLAM >20 && feature.properties.TOPLAM < 30) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#800000', 
                                                color: '#800000', 
                                                fillOpacity: 0.5
                                              })
                                              .addTo(map)
                                              .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  // siyah
                  else if (feature.properties.TOPLAM >30) {
                    L.polygon(coordinates[0], {
                                                fillColor: '#011400', 
                                                color: '#011400', 
                                                fillOpacity: 0.5
                                              })
                                                .addTo(map)
                                                .bindPopup('Yangın Sayısı:' + String(feature.properties.TOPLAM));
                  }
                  }
              }
          }
      };
      xhr.send();
      }
    </script>


  </body>
</html>